<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="pointer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">


<dom-module id="image-element">
    <template>
        <pointer-element  position="{{cursor}}" >
            <img  src="{{currentImage}}" />
        </pointer-element>
        <div>
            <paper-icon-button icon="arrow-back" on-click="previous" disabled$="{{computePreviousDisabled(current)}}" hidden$="{{!showControls}}"></paper-icon-button>
            <paper-icon-button icon="arrow-forward" on-click="next" disabled$="{{computeNextDisabled(current, images.*)}}" hidden$="{{!showControls}}"></paper-icon-button>
            <paper-button on-click="setAsCover"  hidden$="{{!showCover}}" raised="" >Set as cover</paper-button>

        </div>
    </template>
    <style>
        img {
            display: block;
            max-width: 100%;
            margin: auto;
            pointer-events: none;
            cursor: pointer;
        }

        pointer-element {
            display: inline-block;
            max-width: 100%;
        }


        :host {
            display: block;
        }

        paper-button[hidden],paper-icon-button[hidden] {
            display: none;
        }


    </style>
 </dom-module>
<script>
    Polymer( {
        is: "image-element",

        properties: {
            images: {
                type: Array,
                notify: true
            },
            current: {
                type: Number,
                value: 0,
                notify: true
            },
            cursor: {
                type: Object,
                value: function() { return{}; }
            },
            showControls: {
                type: Boolean,
                notify: true,
                value: true
            },
            showCover: {
                type: Boolean,
                notify: true,
                value: false
            },
            currentImage: String,
        },

        observers: [
            'updateCurrentImage(images.*, current)'
        ],

        computePreviousDisabled: function(current){
            return current === 0;
        },
        computeNextDisabled: function(current){
            return !this.images || current >= this.images.length -1;
        },

        updateCurrentImage: function(){
            this.currentImage = this.images[this.current];
        },

        next: function () {
            this.current += 1;
            Platform.performMicrotaskCheckpoint();
        },

        previous: function () {
            if (this.current > 0){
                this.current -= 1;
                Platform.performMicrotaskCheckpoint();
            }
        },

        setAsCover: function() {
            this.fire('cover', {src: this.images[this.current]});
        }

    });
</script>
